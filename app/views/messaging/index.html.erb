<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>AdminLTE | Mailbox</title>
    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
    <%= stylesheet_link_tag "//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" , media: 'all', 'data-turbolinks-track' => true %>
    <%= stylesheet_link_tag "//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css", media: 'all', 'data-turbolinks-track' => true %>
    <%= stylesheet_link_tag "//code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css", media: 'all', 'data-turbolinks-track' => true %>
</head>

<body class="skin-blue">


    <aside>
        <section class="content-header no-margin">
            <h1 class="text-center">
                Mailbox
            </h1>
        </section>

        <section class="content">
            <div class="mailbox row">
                <div class="col-xs-12 col-md-12">
                    <div class="box box-solid">
                        <div class="box-body">
                            <div class="row">
                                <div class="col-md-3 col-sm-4">
                                    <div class="box-header">
                                        <i class="fa fa-inbox"></i>
                                        <h3 class="box-title">INBOX</h3>
                                    </div>
                                    <a class="btn btn-block btn-primary" data-toggle="modal" data-target="#compose-modal"><i class="fa fa-pencil"></i> Compose Message</a>
                                    <div style="margin-top: 15px;">
                                        <ul class="nav nav-pills nav-stacked">
                                            <li class="header">Folders</li>
                                            <li class=""><a href="../messaging/index"><i class="fa fa-inbox"></i>Inbox</a>
                                            </li>
                                            <li><a href="../messaging/sent"><i class="fa fa-mail-forward"></i>Sent</a>
                                            </li>
                                            <li><a href="../messaging/trash"><i class="fa fa-folder"></i> Trash</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-md-9 col-sm-8">


                                    <div class = "jrender" id="mlz">
                                    </div>
                                    <div class="table-responsive" style="padding-top:42px;">
                                        <table class="table table-mailbox">
                                            <% @user.each do |y| %>
                                            <% y.received_messages.each do |message| %>

                                            <tr class="unread">
                                                <td class="small-col">
                                                    <% if message.seen == "1" %>
                                                    <p class="message-seen" ></p>
                                                    <% end %>
                                                </td>
                                                <td class="small-col"><i class="fa fa-star"></i>
                                                </td>
                                                <td class="name"><p><%= @user_ids[message.sent_messageable_id.to_s] %></p>
                                                </td>

                                                <td class="subject"><%= link_to message.topic, inbox_path(:mid => message.id), :remote => true %>
                                                </td>
                                                <td class="time"><%= message.created_at %></td>
                                            </tr>
                                            <% end %>
                                            <% end %>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </section>
    </aside>
</div>
<%= form_tag(inbox_path, :method => "get") do %>

<div class="modal fade" id="compose-modal" tabindex="-1" role="dialog" aria-hidden="true" id ="compose">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title"><i class="fa fa-envelope-o"></i> Compose New Message</h4>
            </div>
            <form action="#" method="post">
                <div class="modal-body">
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">TO:</span>
                            <%= text_field_tag :to, params[:to], :class => "form-control", :placeholder => "Enter name of the user eg: Sean" %>        
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">MAILING-LIST:</span>
                            <%= text_field_tag :mlist, params[:mlist], :class => "form-control", :placeholder => "(Please provide either this field OR the field above, NOT both)" %>   
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">FROM:</span>
                            <%= text_field_tag :from, params[:from],:required => true, :class => "form-control" %>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">SUBJECT:</span>
                            <%= text_field_tag :subject, params[:subject], :required => true, :class => "form-control"%>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <%= text_area_tag :body, params[:body],:required => true, :class => "form-control", :rows => 10, :placeholder => "Body", :cols => 90  %>
                        </div>
                    </div>

                </div>
                <div class="modal-footer clearfix">

                    <button type="button" class="btn btn-danger" data-dismiss="modal">Discard</button>

                    <%= submit_tag "Send Message", :class => "btn btn-primary pull-left" %>
                    <% end %>
                </div>
            </form>
        </div>
    </div>
</div>

<p style="text-align:center;"> Click <%= link_to 'here', users_path, :style => "color:blue;" %> to manage users </p>
<p style="text-align:center;"> Click <%= link_to 'here', mailinglists_path, :style => "color:blue;" %> to manage mailing lists </p>

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script>






<script type="text/javascript">
if (String(window.location).indexOf("from") > -1)
{
    window.history.back();
}
$(function() {

    "use strict";

            //iCheck for checkbox and radio inputs
            $('input[type="checkbox"]').iCheck({
                checkboxClass: 'icheckbox_minimal-blue',
                radioClass: 'iradio_minimal-blue'
            });

            //When unchecking the checkbox
            $("#check-all").on('ifUnchecked', function(event) {
                //Uncheck all checkboxes
                $("input[type='checkbox']", ".table-mailbox").iCheck("uncheck");
            });
            //When checking the checkbox
            $("#check-all").on('ifChecked', function(event) {
                //Check all checkboxes
                $("input[type='checkbox']", ".table-mailbox").iCheck("check");
            });
            //Handle starring for glyphicon and font awesome
            $(".fa-star, .fa-star-o, .glyphicon-star, .glyphicon-star-empty").click(function(e) {
                e.preventDefault();
                //detect type
                var glyph = $(this).hasClass("glyphicon");
                var fa = $(this).hasClass("fa");

                //Switch states
                if (glyph) {
                    $(this).toggleClass("glyphicon-star");
                    $(this).toggleClass("glyphicon-star-empty");
                }

                if (fa) {
                    $(this).toggleClass("fa-star");
                    $(this).toggleClass("fa-star-o");
                }
            });

            //Initialize WYSIHTML5 - text editor
            $("#email_message").wysihtml5();
        });
</script>

</body>

</html>